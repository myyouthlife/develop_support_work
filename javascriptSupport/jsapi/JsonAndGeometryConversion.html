<!DOCTYPE html>
<html >
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="http://192.168.100.82/jsapi315/dijit/themes/claro/claro.css">
	<link rel="stylesheet" href="http://192.168.100.82/jsapi315/esri/css/esri.css">
	<style type="text/css">
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    overflow:hidden;
}

#borderContainerTwo {
    width: 100%;
    height: 100%;
}

#borderleft{
width:70%;
}
#myMap{
height:100%;
}
	</style>

	<script src='http://192.168.100.82/jsapi315/dojo/dojo.js'></script>
	<script src='http://192.168.100.82/jsapi315/init.js'></script>
<script type="text/javascript">
  dojoConfig = {
    locale: "zh-cn",
    parseOnLoad: true
  };
</script>
	
	<script>
require(["dojo/parser",
"esri/map",
"esri/toolbars/draw",
"esri/symbols/SimpleMarkerSymbol", "esri/symbols/SimpleLineSymbol","esri/symbols/PictureFillSymbol", "esri/symbols/CartographicLineSymbol", "esri/symbols/SimpleFillSymbol",
"esri/graphic",
"dojo/i18n!esri/nls/jsapi",
"esri/Color", "dojo/dom", "dojo/on", "dojo/domReady!",

"dijit/layout/ContentPane", "dijit/layout/BorderContainer", "dijit/layout/TabContainer"
],function(parser,Map,Draw,SimpleMarkerSymbol,SimpleLineSymbol,PictureFillSymbol,CartographicLineSymbol,SimpleFillSymbol,Graphic,bundle,Color,dom,on){
parser.parse();
bundle.toolbars.draw.addPoint = "点我";
var map
map = new Map("myMap", {
          basemap: "streets",
          center: [-25.312, 34.307],
          zoom: 3
        });

map.on("load",initToolbar);



 var markerSymbol = new SimpleMarkerSymbol();
        markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z");
        markerSymbol.setColor(new Color("#00FFFF"));

		
        // lineSymbol used for freehand polyline, polyline and line. 
var lineSymbol = new CartographicLineSymbol(
          CartographicLineSymbol.STYLE_SOLID,
          new Color([255,0,0]), 10, 
          CartographicLineSymbol.CAP_ROUND,
          CartographicLineSymbol.JOIN_MITER, 5
        );
  var fillSymbol = new PictureFillSymbol(
          "images/mangrove.png",
          new SimpleLineSymbol(
            SimpleLineSymbol.STYLE_SOLID,
            new Color('#000'),1), 
          42, 
          42
        );
	
		
	var simplefillSymbol=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID,lineSymbol,
	new Color('#000'));	
	

function initToolbar(){

	tb=new Draw(map);
	tb.on("draw-end",addGraphic);
	on(dom.byId("info"),"click",function(evt){

	if(evt.target.id==="info")
	{return;}
	var tool=evt.target.id.toLowerCase();
	map.disableMapNavigation();
	tb.activate(tool);
});
}

function addGraphic(evt) {
          //deactivate the toolbar and clear existing graphics 
          tb.deactivate(); 
          map.enableMapNavigation();
		  map.graphics.clear();
		     var symbol;
         /*
          // figure out which symbol to use
       
		  
          if ( evt.geometry.type === "point" || evt.geometry.type === "multipoint") {
            symbol = markerSymbol;
          } else if ( evt.geometry.type === "line" || evt.geometry.type === "polyline") {
            symbol = lineSymbol;
          }
          else {
            symbol = fillSymbol;
          }
          */
		  symbol=checkGeometryType(evt.geometry)
          map.graphics.add(new Graphic(evt.geometry, symbol)); 
		  map.graphics.on("click",testfun);
		  
		  //create the json of the geometry
		  document.getElementById("divjson").innerHTML=JSON.stringify(evt.geometry.toJson());
		  
		  
}

function checkGeometryType(jsonGeometry)
{
      var symbol;
          if ( jsonGeometry.type === "point" || jsonGeometry.type === "multipoint") {
            symbol = markerSymbol;
          } else if ( jsonGeometry.type === "line" ||jsonGeometry.type === "polyline") {
            symbol = lineSymbol;
          }
          else {
            symbol = fillSymbol;
          }
		 return symbol;
}

function testfun()
{
	alert("what's wrong");
}

on(dom.byId("ConvertToGeometry"),"click",function(evt){
	if(dom.byId(jsonText).value)
	{
	    jsonGeometry=JSON.parse(dom.byId(jsonText).value);
		symbol=checkGeometryType(jsonGeometry).toJson();
		
		newjsonGeometry={"geometry":jsonGeometry,"symbol":symbol}
        map.graphics.add(new Graphic(newjsonGeometry)); 
	
		
	}
	else
	{
	 alert("please input valid geometry json");
	}


	});
});


	</script>
</head>
<body class="claro">
    <div data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="gutters:true, liveSplitters:false" id="borderContainerTwo">
    <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'top', splitter:false" id="borderHeader">
        Hi, usually here you would have important information, maybe your company logo, or functions you need to access all the time..
    </div>
	 <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'left', splitter:false" id="borderleft">
      <div id="myMap"></div>
    </div>
    
    <div data-dojo-type="dijit/layout/TabContainer" data-dojo-props="region:'center', tabStrip:true">
        <div data-dojo-type="dijit/layout/ContentPane" title="To Json" selected="true">
         <div id="info">
		  <div>Select a shape then draw on map to add graphic</div>
		  <button id="Point">Point</button>
		  <button id="Multipoint">Multipoint</button>
		  <button id="Line">Line</button>
		  <button id="Polyline">Polyline</button>
		  <button id="FreehandPolyline">Freehand Polyline</button>
		  <button id="Triangle">Triangle</button>
		  <button id="Extent">Rectangle</button>
		  <button id="Circle">Circle</button>
		  <button id="Ellipse">Ellipse</button>
		  <button id="Polygon">Polygon</button>
		  <button id="FreehandPolygon">Freehand Polygon</button>
		</div>
		<div id="divjson"> 
		</div>
        </div>
		
        <div data-dojo-type="dijit/layout/ContentPane" title="To Geometry" >
		<div data-dojo-type="dijit/layout/ContentPane">
		<button id="ConvertToGeometry">ConvertToGeometry</button>
		</div>   
       <div data-dojo-type="dijit/layout/ContentPane" style="height:100%;weight:100%" >
		<textarea id="jsonText" style="width:90%;height:50%;">Enter json text here...</textarea>
		</div>  		
		
        </div>
		
        <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="closable:true" title="My last tab">
        Lorem ipsum and all around - last...
        </div>
    </div><!-- end TabContainer -->
</div><!-- end BorderContainer -->
</body>
</html>